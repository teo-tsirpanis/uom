\documentclass{article}

\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{hyperref}
\usepackage{fontspec}
\usepackage[greek,english]{babel}

\usepackage{listings}
\lstloadlanguages{Python}
\lstset{
    language=Python,
    basicstyle=\small\ttfamily,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    numbers=left,
    numbersep=5pt,
    keepspaces=true,
    showstringspaces=false,
    tabsize=2}

\setmainfont{Ubuntu}
\setmonofont{Ubuntu Mono}

\title{Κρυπτογραφία--Άσκηση 5: Πεπερασμένα Σώματα}
\author{Τσιρπάνης Θεόδωρος\\ \texttt{dai19090}}
\date{Νοέμβριος 2019}

\begin{document}

\selectlanguage{greek}

\maketitle

\section*{Ερώτημα 1}

Το ερώτημα αυτό μας ζητάει να υπολογίσουμε τον πολλαπλασιαστικό πίνακα του $GF(2^3)=\mathbb{Z}_2[x]/(x^3 + x + 1)$. Αυτό μπορεί να γίνει με λίγες γραμμές κώδικα στο SageMath:

\begin{lstlisting}
x = var('x')
F.<x> = GF(2**3, modulus = x^3 + x + 1)
show(F.multiplication_table())
\end{lstlisting}

Εκτελώντας τες, έχουμε το παρακάτω αποτέλεσμα. Τα μέλη του σώματος εκφράζονται σε δυαδική μορφή:

$$
\newcommand{\Bold}[1]{\mathbf{#1}}{\setlength{\arraycolsep}{2ex}
\begin{array}{r|*{8}{r}}
\multicolumn{1}{c|}{\ast}
&000&001&010&011&100&101&110&111\\\hline
{}000&000&000&000&000&000&000&000&000\\
{}001&000&001&010&011&100&101&110&111\\
{}010&000&010&100&110&011&001&111&101\\
{}011&000&011&110&101&111&100&001&010\\
{}100&000&100&011&111&110&010&101&001\\
{}101&000&101&001&100&010&111&011&110\\
{}110&000&110&111&001&101&011&010&100\\
{}111&000&111&101&010&001&110&100&011\\
\end{array}}
$$

\section*{Ερώτημα 2}

Στο επόμενο ερώτημα θα υπολογίσουμε το άθροισμα δύο πολυωνύμων στο $GF(2^3)=\mathbb{Z}_2[x]/(x^4 + x + 1)$.

\begin{itemize}
    \item $(x^2 + 1) + (x^3 + x^2 + 1) = x^3 + 2x^2 + 2 = x^3$
    \item $(x^2 + 1) + (x + 1) = x^2 + x + 2 = x^2 + x$
\end{itemize}

Αυτό γίνεται και με τον κώδικα που παρατίθεται παρακάτω:

\begin{lstlisting}
x = var('x')
F.<x> = GF(2**4, modulus = x^4 + x + 1)
AB = [(x^2 + 1, x^3 + x^2 + 1), (x^2 + 1, x + 1)]

for (A, B) in AB:
    show(A + B)
\end{lstlisting}

Για να σκεφτούμε τι θα γίνει αν αλλάζαμε το ανάγωγο πολυώνυμο. Η απάντηση σε αυτήν την ερώτηση είναι εκπληκτικά απλή. Το ανάγωγο πολυώνυμο καθορίζει τι θα γίνει αν υπάρξει υπερχείλιση σε μια πράξη. Στο παράδειγμά μας, υπολογίζοντας το υπόλοιπο $x^4 + x + 1 = 0 \Leftrightarrow x^4 = -x - 1 \Leftrightarrow x^4 = x + 1$ σημαίνει ότι το $x^4$ θα αντικατασταθεί όπου υπάρχει με το $x + 1$ -- και επαγωγικά το $x^5 = x(x^4)$ με το $x(x + 1) = x^2 + x$ και ούτω καθ' εξής, μέχρι να μην μπορούν να γίνουν άλλες αντικαταστάσεις, όπου το πολυώνυμο θα έχει γίνει το πολύ τρίτου βαθμού.

Μια πρόσθεση ενός πολυωνύμου με ένα άλλο όμως, δεν μπορεί ποτέ να αυξήσει τον βαθμό του, επειδή η αύξησή του υπονοεί έναν πολλαπλασιασμό με το $x$. Αυτό σημαίνει ότι το ανάγωγο πολυώνυμο ενός πεπερασμένου σώματος δεν επηρεάζει το αποτέλεσμα μιας πρόσθεσης πολυωνύμων που ανήκουν σε αυτό.

\section*{Ερώτημα 3}

Αυτό το ερώτημα μοιάζει πολύ με το προηγούμενο, μόνο που ζητείται ο πολλαπλασιασμός των πολυωνύμων αντί της πρόσθεσης.

\begin{itemize}
    \item
        \begin{align*}
        (x^2 + 1) \cdot (x^3 + x^2 + 1) = \\
        (x^5 + x^4 + x^2) + (x^3 + x^2 + 1) = \\
        x^5 + x^4 + x^3 + 1 = \\
        x(x^4) + x^4 + x^3 + 1 = \\
        x(x + 1) + (x + 1) + x^3 + 1 = \\
        x^2 + x + x + 1 + x^3 + 1 = \\
        x^3 + x^2 + 2x + 2 = \\
        \underline{x^3 + x^2}
        \end{align*}
    \item $(x^2 + 1) \cdot (x + 1) = x^3 + x + x^2 + 1 = \underline{x^3 + x^2 + x + 1}$
\end{itemize}

Στον παραπάνω κώδικα, το μόνο που έχουμε να αλλάξουμε είναι η τελευταία γραμμή που πρέπει να ξαναγράψουμε ως \lstinline|show(A * B)|.

Σχετικά με τον ρόλο του ανάγωγου πολυωνύμου, είπαμε πριν ότι καθορίζει το αποτέλεσμα όταν υπάρχει υπερχείλιση. Στο δεύτερο γινόμενο δεν υπάρχει υπερχείλιση, επειδή το άθροισμα του βαθμού τον τελεστέων δεν είναι μεγαλύτερο του $3$· της τάξης του πεπερασμένου σώματος, άρα το αποτέλεσμα δεν θα αλλάξει αν άλλαζε το ανάγωγο πολυώνυμο. Στο πρώτο γινόμενο όμως, το άθροισμα του βαθμού των τελεστέων είναι $5 > 3$, που σημαίνει ότι θα πραγματοποιηθεί μια εύρεση υπολοίπου mod $x^4 + x + 1$. Συνεπώς, το ανάγωγο πολυώνυμο επηρεάζει το πρώτο γινόμενο.

\section*{Ερώτημα 4}

Το τελευταίο ερώτημα είναι πιο πρακτικό. Έχουμε τον πίνακα εισόδου $A$ και το πρώτο υποκλειδί

$$
A = K_1 =
\begin{bmatrix}
FF & FF & FF & FF \\
FF & FF & FF & FF \\
FF & FF & FF & FF \\
FF & FF & FF & FF \\
\end{bmatrix}
$$

και ζητείται να εκτελέσουμε τον πρώτο γύρο του AES.

\subsection*{SubBytes}

Βλέποντας \href{https://en.wikipedia.org/wiki/Rijndael_S-box}{τον πίνακα}, η τιμή $FF$ στο S-box αντιστοιχίζεται στην τιμή $16$. Συνεπώς ο πίνακας γίνεται

$$
A' =
\begin{bmatrix}
16 & 16 & 16 & 16 \\
16 & 16 & 16 & 16 \\
16 & 16 & 16 & 16 \\
16 & 16 & 16 & 16 \\
\end{bmatrix}
$$

\subsection*{ShiftRows}

Η εκτέλεση του ShiftRows είναι εκπληκτικά απλή. Επειδή όλα τα στοιχεία του πίνακα είναι τα ίδια, δεν έχει νόημα να εκτελέσουμε το βήμα αυτό, που σημαίνει ότι μπορούμε να το παραλείψουμε.

\subsection*{MixColumns}

Το προτελευταίο βήμα ενός γύρου του AES (εκτός από τον τελευταίο) είναι το MixColumns. Πριν προσπαθήσουμε να το υπολογίσουμε, θα συζητήσουμε μερικά πράγματα για αυτό το βήμα.

Πρώτα απ' όλα το MixColumns ορίζεται ως ένας πολλαπλασιασμός της κάθε στήλης του πίνακα με τον πίνακα στοιχείων του πεπερασμένου σώματος του AES:

$$
\begin{bmatrix}
2 & 3 & 1 & 1 \\
1 & 2 & 3 & 1 \\
1 & 1 & 2 & 3 \\
3 & 1 & 1 & 2
\end{bmatrix} =
\begin{bmatrix}
x & x + 1 & 1 & 1 \\
1 & x & x + 1 & 1 \\
1 & 1 & x & x + 1 \\
x + 1 & 1 & 1 & x
\end{bmatrix}
$$

Τι θα γίνει αν κάθε στοιχείο της στήλης είναι το ίδιο (έστω $p$); Ας δούμε πώς θα γίνει το πρώτο στοιχείο (έστω $c_1$) για παράδειγμα:

\begin{align*}
c_1 &= \begin{bmatrix} p \\ p \\ p \\ p \end{bmatrix} \cdot [x \ (x + 1) \ 1 \ 1] = \\
    &= p \cdot x + p \cdot (x + 1) + p + p = \\
    &= p ( x + x + 1 + 1 + 1) = \\
    &= p (2x + 3) = \\
    &= p
\end{align*}

Το ίδιο ισχύει και για τα άλλα τρία στοιχεία του πίνακα, αφού οι συντελεστές είναι οι ίδιοι, αλλά με αλλαγμένες θέσεις.

Το συμπέρασμα είναι ότι \textbf{η εκτέλεση του MixColumns σε μια στήλη, δεν την αλλάζει όταν όλα τα στοιχεία της είναι τα ίδια}.

Οπλισμένοι με αυτήν την πληροφορία, καταλήγουμε ότι ούτε το MixColumns αλλάζει κάπως τον πίνακα και συνεπώς μπορεί να παραλειφθεί κι' αυτό.

\section*{AddRoundKey}

Το τελευταίο βήμα του γύρου είναι στην ουσία μία πράξη \texttt{XOR} των bytes του πίνακα, με τα bytes του πρώτου υποκλειδιού, ορίζοντας το αποτέλεσμα του πρώτου γύρου ως:

\begin{align*}
C_1 &= A' \oplus K_1 = \\
    &=
    \begin{bmatrix}
    16 & 16 & 16 & 16 \\
    16 & 16 & 16 & 16 \\
    16 & 16 & 16 & 16 \\
    16 & 16 & 16 & 16 \\
    \end{bmatrix} \oplus
    \begin{bmatrix}
    FF & FF & FF & FF \\
    FF & FF & FF & FF \\
    FF & FF & FF & FF \\
    FF & FF & FF & FF \\
    \end{bmatrix} = \\
    &=
    \begin {bmatrix}
    E9 & E9 & E9 & E9 \\
    E9 & E9 & E9 & E9 \\
    E9 & E9 & E9 & E9 \\
    E9 & E9 & E9 & E9 \\
    \end {bmatrix}
\end{align*}

\end{document}