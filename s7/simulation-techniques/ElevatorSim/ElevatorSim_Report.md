# Τεχνικές προσομοίωσης ~ Εργασία 3

### Θοδωρής Τσιρπάνης (`dai19090`)

## Εισαγωγή

Στο πλαίσιο της επιλογής θέματος της τρίτης εργασίας του μαθήματος "Τεχνικές Προσομοίωσης" περιέγραψα την ιδέα μου στο παρακάτω email:

> ### Ένα σύστημα ανελκυστήρων
>
> Από τότε που ξεκίνησα την φοίτησή μου στο τμήμα με παραξένευε ο τρόπος με τον οποίο λειτουργούν οι ανελκυστήρες κάθε πύργου του ΠΑΜΑΚ, και συγκεκριμένα η ύπαρξη δύο ζευγαριών κουμπιών πάνω και κάτω, αντί για ένα ζευγάρι κουμπιών που θα ελέγχει και τους δύο ανελκυστήρες, προσφέροντας αποδοτικότερη δρομολόγηση. Η περιέργεια αυτή με οδήγησε στην σκέψη να φτιάξω ένα σύστημά που θα προσομοιώνει την κίνηση μιας ομάδας ανελκυστήρων σε ένα κτήριο, και τους ανθρώπους που έρχονται στο ισόγειο, μετακινούνται στους ορόφους, και μετά από κάποιο διάστημα επιστρέφουν στο ισόγειο και φεύγουν.
>
> Θα παραμετροποιούνται μεταξύ άλλων το πλήθος των ορόφων, το πλήθος των ανελκυστήρων, η ταχύτητα των ανελκυστήρων, η συχνότητα άφιξης των ανθρώπων, η μέση διάρκεια παραμονής τους, η διάρκεια της προσομοίωσης, και κυριότερα η στρατηγική δρομολόγησης των ανελκυστήρων (αν θα υπάρχουν ένα ή πολλά σετ κουμπιών και αν θα λαμβάνουν υπόψη αν ο άνθρωπος θέλει να πάει πάνω ή κάτω).
>
> Η προσομοίωση θα βγάζει ως αποτελέσματα μετρικές αποδοτικότητας όπως τον μέσο χρόνο αναμονής των ανθρώπων και την συνολική απόσταση που διένυσαν οι ανελκυστήρες, επιτρέποντας την σύγκριση των διαφορετικών στρατηγικών δρομολόγησης.

Δύο μήνες αργότερα η εργασία έχει ολοκληρωθεί, και η αναφορά αυτή περιγράφει το σύστημα υπό προσομοίωση, καθώς και κάποια στοιχεία της υλοποίησής του.

## Το σύστημα υπό προσομοίωση

Όπως αναφέρθηκε προηγουμένως, το σύστημα προσομοιώνει την καθημερινή κίνηση σε ένα πολυόροφο κτήριο με έναν ή περισσότερους ανελκυστήρες και χωρίς σκάλες.

Μέσα στην ημέρα, έρχεται ένα πλήθος ανθρώπων στο ισόγειο και περιπλανιέται στους διάφορους ορόφους του κτηρίου μετακινούμενο με τους ανελκυστήρες, επιστρέφοντας κάποια στιγμή στο ισόγειο και φεύγοντας από το κτήριο. Μπορούμε να δείξουμε με ψευδοκώδικα τις δραστηριότητες ενός ανθρώπου μέσα στο κτήριο:

### Αλγόριθμος Ανθρώπου

1. Μπες στο κτήριο από την πόρτα του ισογείου.
1. Επανάλαβε για έναν κανονικά κατανεμημένο τυχαίο αριθμό φορών αλλά τουλάχιστον μία φορά:
    1. Πήγαινε στην ουρά για τον ανελκυστήρα στον όροφο που βρίσκεσαι.
    1. Όταν έρθει η σειρά σου επανάλαβε μέχρι να μπορέσεις να μπεις σε κάποιον ανελκυστήρα:
        1. Πάτησε το κουμπί της κατεύθυνσης που θέλεις να πας και περίμενε να έρθει κάποιος ανελκυστήρας.
        1. Όταν έρθει, περίμενε να ανοίξει η πόρτα.
        1. Όταν ανοίξει η πόρτα του ανελκυστήρα, μπες μέσα αν υπάρχει αρκετός χώρος.
        1. Αν ο ανελκυστήρας είναι γεμάτος, περίμενε μέχρι να φύγει και κάλεσέ τον ξανά.
    1. Διάλεξε έναν ομοιόμορφα κατανεμημένο τυχαίο αριθμό του ορόφου στον οποίο θα πας, ο οποίος πρέπει να έιναι διαφορετικός από τον αριθμό του ορόφου που βρίσκεσαι και όχι το ισόγειο.
    1. Περίμενε να φτάσει ο ανελκυστήρας στον όροφο που επέλεξες και να ανοίξει την πόρτα του.
    1. Βγες από τον ανελκυστήρα, και μείνε στον όροφο για μία κανονικά κατανεμημένη χρονική ποσότητα.
1. Τέλος επανάληψης.
1. Ακολούθησε τα βήματα 2.2.1 έως 2.2.3.
1. Όταν μπεις μέσα στον ανελκυστήρα, πάτησε το κουμπί για να πας στο ισόγειο.
1. Περίμενε να φτάσει ο ανελκυστήρας στο ισόγειο και να ανοίξει την πόρτα του.
1. Βγες από το κτήριο.

Η άφιξη των ανθρώπων στο κτήριο περιγράφεται με τον εξής ψευδοκώδικα:

### Αλγόριθμος Άφιξης Ανθρώπων

1. Επανάλαβε έναν ορισμένο αριθμό φορών:
    1. Εκκίνησε τον _Αλγόριθμο Ανθρώπου_ αλλά ασύγχρονα, χωρίς να περιμένεις τον τερματισμό του.
    1. Περίμενε για μία εκθετικά κατανεμημένη χρονική ποσότητα.

Η ασύχρονη εκτέλεση του _Αλγορίθμου Ανθρώπου_ στο βήμα 1.1 του _Αλγορίθμου Άφιξης Ανθρώπων_ επιτρέπει την ταυτόχρονη παρουσία πολλών ανθρώπων μέσα στο κτήριο.

Όταν οι άνθρωποι καλούν τον ανελκυστήρα, το αίτημά τους το επεξεργάζεται μια οντότητα που λέγεται ο _ελεγκτής ανελκυστήρων_. Ο ψευδοκώδικας της λειτουργίας του ελεγκτή ανελκυστήρων είναι ο εξής:

### Αλγόριθμος Ελεγκτή Ανελκυστήρων

1. Όταν λάβεις κάποιο αίτημα κατά το βήμα 2.2.1 του _Αλγορίθμου Ανθρώπου_, με ορίσματα τον όροφο από όπου έλαβες το αίτημα και την κατεύθυνση μετακίνησης:
    1. Αν στο κτήριο υπάρχει μόνο ένας ανελκυστήρας:
        1. Στείλε αίτημα στον ανελκυστήρα αυτόν για να σταματήσει στον όροφο.
    1. Αλλιώς:
        1. Με βάση μια _στρατηγική_, διάλεξε τουλάχιστον έναν ανελκυστήρα για να του(ς) στείλεις αίτημα να πάνε στον όροφο.

Υλοποιήθηκαν δύο στρατηγικές δρομολόγησης ανελκυστήρων, η _απλή_ και η _έξυπνη_· ο σκοπός της εργασίας είναι η σύγκρισή τους. Θα τις περιγράψουμε με ελεύθερο κείμενο:

* Η __απλή στρατηγική__ παρομοιάζει την συμπεριφορά του μέσου χρήστη των ανελκυστήρων του ΠΑΜΑΚ: καλεί τον πιο κοντινό ανελκυστήρα στον όροφο που ελήφθη το αίτημα, και αν κάποιοι ανελκυστήρες ισαπέχουν, καλεί όλους τους ισαπέχοντες.
* Η __έξυπνη στρατηγική__ χρησιμοποιεί περισσότερες πληροφορίες: καλεί τον πιο κοντινό ανελκυστήρα στον όροφο που ελήφθη το αίτημα, ο οποίος πρέπει είτε να είναι ανενεργός, είτε να είναι ακίνητος και να βρίσκεται στον όροφο που ελήφθη το αίτημα, είτε να κινείται προς την κατεύθυνση του αίτηματος και να πλησιάζει τον όροφο (δηλαδή να βρίσκεται κάτω απ' τον όροφο και να κινείται προς τα πάνω, ή πάνω από τον όροφο και να κινείται προς τα κάτω). Αν κανένας ανελκυστήρας δεν πληρεί τα κριτήρια τη δεδομένη χρονική στιγμή, ακολουθεί το παράδειγμα της απλής στρατηγικής και καλεί τον πιο κοντινό από όλους τους ανελκυστήρες, αλλά σε κάθε περίπτωση καλεί μόνο έναν· αν κάποιοι ανελκυστήρες ισαπέχουν, καλεί έναν τυχαίο από αυτούς.

### Οι ανελκυστήρες

Ανεξαρτήτως της στρατηγικής του ελεγκτή λειτουργεί ο μεμονωμένος ανελκυστήρας. Η λογική του είναι η πιο σύνθετη από τις οντότητες του συστήματος, κυρίως επειδή ο ανελκυστήρας διατηρεί μια εσωτερική κατάσταση που αποτελείται από τις εξής τιμές:

* Ο **αριθμός ορόφου** του κτηρίου που βρίσκεται ο ανελκυστήρας. Στην αρχή βρίσκεται στο ισόγειο (στον όροφο μηδέν).
* Η **κατάσταση κίνησης** του ανελκυστήρα, είτε _ακίνητος_ είτε _εν κινήσει_. Στην αρχή είναι _ακίνητος_.
* Η **κατεύθυνση** προς την οποία κινείται ο ανελκυστήρας, πάνω ή κάτω. Εφόσον ο ανελκυστήρας ξεκινά ακίνητος, η αρχική τιμή της κατεύθυνσής του δεν έχει νόημα.
* Η **κατάσταση ενεργοποίησης** του ανελκυστήρα, είτε _ενεργός_, είτε _προς ενεργοποίηση_ είτε _ανενεργός_. Στην αρχή είναι _ανενεργός_.
* Η **κατάσταση πόρτας** του ανελκυστήρα, είτε _ανοιχτή_, είτε _προς άνοιγμα_, είτε _προς κλείσιμο_, είτε _κλειστή_. Στην αρχή είναι _κλειστή_. Στην πραγματικότητα υπάρχουν πολλές πόρτες του ίδιου ανελκυστήρα σε κάθε όροφο, αλλά εφόσον μόνο μία μπορεί να είναι ανοιχτή κάθε φορά, χρησιμοποιούμε μόνο μία μεταβλητή για να αποθηκεύσουμε την κατάστασή της.
* Οι **καλούντες όροφοι**, ένα σύνολο των αριθμών των ορόφων του κτηρίου, συμπεριλαμβανομένου του ισογείου. Στην αρχή είναι κενό.
* Οι **επιβάτες**, ένα σύνολο των αριθμών των επιβάτων που βρίσκονται στον ανελκυστήρα, μαζί με τον αριθμό ορόφου στον οποίον θέλουν να πάνε. Στην αρχή είναι κενό.

Δεν είναι όλοι οι συνδυασμοί τιμών έγκυροι. Για παράδειγμα ο ανελκυστήρας δε μπορεί να κινείται αν δεν είναι ενεργός, ή αν η πόρτα δεν είναι κλειστή.

Ο αλγόριθμος του ανελκυστήρα είναι αρκετά πολύπλοκος για να περιγραφτεί με ψευδοκώδικα (περιγράφεται άλλωστε με πραγματικό κώδικα στο αρχείο `ElevatorSim/Elevator.cs`), οπότε θα γράψουμε τις απαιτήσεις που πρέπει να πληροί:

* Ο ανελκυστήρας μεταβαίνει από την ανενεργή κατάσταση στην κατάσταση προς ενεργοποίηση, όταν κληθεί να πάει σε κάποιον όροφο διαφορετικό από αυτόν που βρίσκεται, όπου και θέτει την κατεύθυνσή του ανάλογα. Μεταβαίνει στην ενεργή κατάσταση όταν η πόρτα κλείσει. Ο διαχωρισμός των καταστάσεων σε ενεργή και προς ενεργοποίηση υπάρχει για να αποφευχθεί η ταυτόχρονη ενεργοποίηση του ανελκυστήρα από πολλούς ορόφους.
* Μόλις ενεργοποιηθεί, ο ανελκυστήρας αρχίζει να κινείται προς την κατεύθυνσή του, μεταβάλλοντας τον αριθμό ορόφου του κατά ένα ή μείον ένα, περίμένοντας μια σταθερή χρονική ποσότητα κάθε φορά.
* Όταν ο ανελκυστήρας κληθεί να πάει σε κάποιον όροφο προσθέτει τον αριθμό του ορόφου στο σύνολο των καλούντων ορόφων, και εφαρμόζει το πρώτο bullet point.
* Ο ανελκυστήρας εξυπηρετεί πρώτα τους καλούντες ορόφους που βρίσκονται μπροστά του προς την κατεύθυνσή του, η οποία αντιστρέφεται μόνο όταν ο ανελκυστήρας δεν έχει κανέναν καλούντα όροφο μπροστά του αλλά έχει από την αντίθετη κατεύθυνση.
* Αν το σύνολο των καλούντων ορόφων του ανελκυστήρα είναι κενό, σταματάει να κινείται και μεταβαίνει στην ανενεργή κατάσταση.
* Ο ανελκυστήρας σταματάει να κινείται και όταν ο αριθμός ορόφου του ανήκει στους καλούντες ορόφους. Στην περίπτωση αυτήν ανοίγει την πόρτα, και αφού ανοίξει, αφαιρεί τους επιβάτες που ήθελαν να σταματήσουν στον όροφο αυτόν, και αφαιρεί τον αριθμό ορόφου του από τους καλούντες ορόφους. Συνεχίζει την κίνηση κατά το δεύτερο bullet point αφού κλείσει η πόρτα του.
* Η πόρτα του ανελκυστήρα μεταβαίνει από την κλειστή κατάσταση στην κατάσταση προς άνοιγμα, αμέσως όταν κληθεί να ανοίξει. Μεταβαίνει στην ανοιχτή κατάσταση μετά την παρέλευση μιας σταθερής χρονικής ποσότητας.
* Μετά την παρέλευση μιας σταθερής χρονικής ποσότητας από το άνοιγμα, η πόρτα αρχίζει να κλείνει και μεταβαίνει από την ανοιχτή κατάσταση στην κατάσταση προς κλείσιμο.
* Αφού περιμένει για μια σταθερή χρονική ποσότητα μετά την μετάβαση στην κατάσταση προς κλείσιμο, αν η πόρτα παραμένει στην κατάσταση αυτήν, μεταβαίνει στην κλειστή κατάσταση, αλλιώς μεταβαίνει στην ανοιχτή κατάσταση, όπου εφαρμόζεται ξανά το αμέσως προηγούμενο bullet point.
* Καθώς η πόρτα βρίσκεται στην κατάσταση προς κλείσιμο, αν κληθεί να ανοίξει, μεταβαίνει αμέσως στην κατάσταση προς άνοιγμα.
