# Κρυπτογραφία ~ Άσκηση 1: Επίθεση μόνο Κρυπτοκειμένου

### Τσιρπάνης Θεόδωρος (`dai19090`)

## Ερώτημα 1

Το πρώτο ερώτημα της άσκησης αφορά την εύρεση της συχνότητας εμφάνισης κάθε γράμματος σε ένα αγγλικό έργο. Το έργο αυτό θα επιλεγόταν από τα διαθέσιμα κείμενα του [Project Gutenberg](https://www.gutenberg.org).

Για την υποβολή αυτήν, [επελέγη](http://www.gutenberg.org/ebooks/1404) η συλλογή των 85 [_"Federalist Papers"_](https://en.wikipedia.org/wiki/The_Federalist_Papers), που γραφτήκαν με σκοπό την παρότρυνση του κοινού στην κύρωση του συντάγματος των Ηνωμένων Πολιτειών.

Την καταμέτρηση των γραμμάτων στο κείμενο ανέλαβε το πρόγραμμα που επισυνάπτεται στο Παράρτημα Α. Κατόπιν, τα δεδομένα αντιγράφτηκαν χειροκίνητα σε ένα αρχείο CSV, το οποίο αποτέλεσε την πηγή δεδομένων για την δημιουργία του κάτωθι γραφήματος.

![Η συχνότητα γραμμάτων στα Federalist Papers](letter_frequency.svg)

> __Σημείωση:__ τα κείμενα του Project Gutenberg περιέχουν τυποποιημένες δηλώσεις στην αρχή και στο τέλος τους που αφορούν θέματα όπως την άδεια χρήσης τους. Οι δηλώσεις αυτές _δεν_ αφαιρέθηκαν, αλλά επειδή το μέγεθός τους είναι αμελητέο μπροστά στο κυρίως κείμενο, και επειδή είναι κι' αυτές γραμμένες στα Αγγλικά, δεν επηρεάζουν ιδιαίτερα την κατανομή των γραμμάτων.

### Συμπεράσματα από την κατανομή των γραμμάτων

Συγκρίνοντας το γράφημα συχνότητας γραμμάτων των _Federalist Papers_ με αυτό του _The Room with the Little Door_, αυτό που μπορούμε να συμπεράνουμε εύκολα είναι ότι παρότι και τα δύο κείμενα περιέχουν τα γράμματα `E` και `T` με την μεγαλύτερη συχνότητα, μετά από αυτά, η σειρά των πιο συχνών γραμμάτων διαφέρει.

Για το παραπάνω συμπέρασμα, θα πρέπει να θυμηθούμε ότι το αρχείο κειμένου των _Federalist Papers_ έχει μέγεθος 1.1 MB, ενώ αυτό του _The Room with the Little Door_ είναι πολύ μικρότερο, με μέγεθος 194 KB. Φαίνεται πως σε μεγαλύτερα δείγματα αγγλικού κειμένου, η κατανομή είναι διαφορετική, και ίσως να σταθεροποιείται σε κάποιο σχήμα, όσο το μέγεθος του κειμένου αυξάνεται.

## Ερώτημα 2

Το δεύτερο ερώτημα της άσκησης ζητά την αποκρυπτογράφηση κρπυτοκειμένου, κρυπτογραφημένου με τον [κρυπτογραφικό αλγόριθμο μετάθεσης](https://en.wikipedia.org/wiki/Substitution_cipher), με άγνωστο κλειδι. Το δωθέν κρυπτοκείμενο είναι το εξής:

`HUOOPUOHH DT HOBQQUO`

### Ένας ντετερμινιστικός αλγόριθμος επίθεσης κρυπταλγορίθμου αντικατάστασης.

Όπως είδαμε προηγουμένως, παρότι η κατανομή της συχνότητας των γραμμάτων διατηρείται μετά την αντικατάστασή τους, είναι πολύ πτητική ακόμα και μεταξύ μεγάλων κειμένων, που σημαίνει ότι οι κατανομή που μετρήσαμε δεν αντιπροσωπεύει απαραίτητα ένα κείμενο των τριών λέξεων.

Για αυτόν τον λόγο, χρησιμοποιήθηκε ένας εναλλακτικός αλγόριθμος επίθεσης ο οποίος αντιμετωπίζει το κρυπτοκείμενο ως μια σειρά _λέξεων_, και όχι γραμμάτων. Ο αλγόριθμος είναι ντετερμινιστικός, που σημαίνει ότι δεν βασίζεται σε πιθανότητες. Η περιγραφή του σε ψευδοκώδικά δίνεται παρακάτω, και η υλοποίησή του στην Python δίνεται στο Παράρτημα Α.

Επίσης, ο αλγόριθμος χρειάζεται ένα λεξικό με λέξεις στην γλώσσα του καθαρού κειμένου που πρόκειται να αναζητήσει. Χρησιμοποιήθηκε ένα λεξικό με 370 χιλιάδες αγγλικές λέξεις που είναι [διαθέσιμο στο GitHub](https://github.com/dwyl/english-words/blob/master/words_alpha.txt).

#### Εισαγωγικές έννοιες

Ως _Κώδικα Πρώτης Περίστασης (First Incidence Code)_ ή _ΚΠΠ_ μίας ακολουθίας χαρακτήρων `C`, ορίζουμε την ακολουθία ψηφίων `U` ίσου μήκους με την `C`, τέτοια ώστε το `i`οστό στοιχείο της `U` είναι η θέση που το `i`οστό στοιχείο της `C` συναντάται για πρώτη φορά.

Υποθέτουμε ότι το πρώτο στοιχείο μίας ακολουθίας είναι το στοιχείο στην θέση 0.

Για παράδειγμα, ο ΚΠΠ των λέξεων `GOOD`, `COOL` είναι `0, 1, 1, 2`, ενώ ο ΚΠΠ της λέξης `FEDERALIST` είναι `0, 1, 2, 1, 3, 4, 5, 6, 7, 8`.

Είναι προφανές ότι ο ΚΠΠ μιας λέξης δεν αλλάζει όταν ο κάθε χαρακτήρας της αντικατασταθεί από έναν άλλον με μία αντιστοίχιση ένα-προς-ένα· κάτι που συμβαίνει στην κρυπτογράφιση με αντικατάσταση.

---

Έχοντας κάνει την εισαγωγή, αυτός είναι ο αλγόριθμος:

> __Σημείωση:__ Το κρυπτοκείμενο είναι μια λίστα λέξεων, όπως και το καθαρό κείμενο. Το κλειδί είναι ένας πίνακας κλειδιων-τιμών που αντιστοιχίζει κάθε χαρακτήρα στο καθαρό κείμενο σε έναν χαρακτήρα στο κρυπτοκείμενο.

```
Αλγόριθμος Επίθεση(Λεξικό, Κρυπτοκείμενο)
Αρχή

  Αλγόριθμος ΘαΜπορούσεΝαΕίναι(ΠιθανόΚλειδί, ΠιθανόΚαθαρόΚείμενο, Κρυπτοκείμενο)
  Αρχή
    // Ο ψευδοκώδικας της συνάρτησης ΚΠΠ παραλείπεται
    Αν ΚΠΠ(ΠιθανόΚαθαρόΚείμενο) != ΚΠΠ(Κρυπτοκείμενο) τότε
      Επίστρεψε Ψευδές
    Για κάθε ι από 0 έως Μήκος(ΠιθανόΚαθαρόΚείμενο) - 1
      Αν το ΠιθανόΚαθαρόΚείμενο[ι] υπάρχει ως κλειδί στο ΠιθανόΚλειδί τότε
        Αν ΠιθανόΚλειδί[ΠιθανόΚαθαρόΚείμενο[ι]] != Κρυπτοκείμενο[ι] τότε
          Επίστρεψε Ψευδές
      Αλλιώς
        Αν το Κρυπτοκείμενο[ι] υπάρχει ως τιμή στο ΠιθανόΚλειδί τότε
          Επίστρεωε Ψευδές
    Επίστρεψε Αληθές
  Τέλος

  Αλγόριθμος loop(Κλειδί, ΠιθανόΚαθαρόΚείμενο: λίστα συμβολοσειρών, ι: ακέραιος)
  Αρχή
    Αν ι = Μήκος(Κρυπτοκείμενο) τότε
      Εμφάνισε ΠιθανόΚαθαρόΚείμενο
    Αλλιώς
      Για κάθε ΠιθανήΛέξη στο Λεξικό
        Αν ΘαΜπορούσεΝαΕίναι(Κλειδι, ΠιθανήΛέξη, Κρυπτοκείμενο[ι]) τότε
          ΝέοΠιθανόΚλειδί := Κλειδί
          Για κ από 0 έως Μήκος(Κρυπτοκείμενο[ι]) - 1
            Πρόσθεσε στο ΝέοΚλειδί το ζεύγος κλειδιού-τιμής (ΠιθανήΛέξη[κ], Κρυπτοκείμενο[ι][κ])
          loop(ΝέοΠιθανόΚλειδί, ΠιθανόΚαθαρόΚείμενο + ΠιθανήΛέξη, ι + 1)
  Τέλος
  loop([], [], 0)
Τέλος
```

Ο αλγόριθμος ακολουθεί την τεχνική της οπισθοδρόμησης (backtracking). Στην ουσία, για κάθε λέξη του κρυπτοκειμένου, χτίζει σταδιακά ένα πιθανό κλειδί, παίρνοντας όλες τις πιθανές αγγλικές λέξεις, και ελέγχει αν ταιριάζουν με την λέξη του κρυπτοκειμένου που εξετάζει (δηλαδή αν έχουν τον ίδιο ΚΠΠ, και αν το μέχρι τώρα κλειδί θα μπορούσε να τις αποκρυπτογραφήσει).

---

Ας δούμε λοιπόν το παράδειγμά μας. Ο ΚΠΠ της λέξης `HUOOPUOHH` είναι `0, 1, 2, 2, 3, 1, 2, 0, 0`. Προς μεγάλη μας τύχη, η μόνη λέξη του λεξικού με αυτόν τον ΚΠΠ είναι η λέξη `SLEEPLESS`. Άρα το κλειδί αντιστοιχίζει το S με το H, το U με το L, και ούτω καθ' εξής.

Ο ΚΠΠ της λέξης `DT` είναι `0, 1`. Υπάρχουν πολλές λέξεις με αυτόν τον ΚΠΠ. Επιπλέον, επειδή οι δύο αυτοί χαρακτήρες δεν υπήρχαν στην προηγούμενη λέξη, δεν έχουμε ιδέα ποιοι θα μπορούσαν να είναι. Όμως, έχουμε κάποια ιδέα ποιοι _δεν_ θα μπορούσαν να είναι. Για παράδειγμα, σίγουρα ούτε το `D`, ούτε το `T` δεν θα είναι `S`, `L`, `E`, ή `P`. Οπότε, λέξεις όπως `HE`, `WE` και άλλες αποκλείονται, και ο αλγόριθμός μας δεν θα τις κοιτάξει καθόλου.

Συνεχίζοντας έτσι, ο αλγόριθμος βρήκε πιθανά καθαρά κείμενα όπως τα παρακάτω:

* `SLEEPLESS OD SEATTLE`
* `SLEEPLESS CO SEATTLE`
* `SLEEPLESS OC SEATTLE`
* `SLEEPLESS HI SEATTLE`
* `SLEEPLESS HO SEATTLE`
* `SLEEPLESS OH SEATTLE`
* `SLEEPLESS NR SEATTLE`
* `SLEEPLESS RN SEATTLE`
* `SLEEPLESS IR SEATTLE`
* `SLEEPLESS OR SEATTLE`
* `SLEEPLESS RO SEATTLE`
* `SLEEPLESS IN SEATTLE`
* `SLEEPLESS NI SEATTLE`
* `SLEEPLESS NO SEATTLE`
* `SLEEPLESS ON SEATTLE`
* `SLEEPLESS IO SEATTLE`

> __Σημείωση:__ Αυτά είναι τα πιο πιθανά κρυπτοκείμενα που βρήκε το πρόγραμμα του Παραρτήματος 1. Είναι ταξινομημένα ώστε αυτό με τα περισσότερα συχνά γράμματα να βρίσκεται στο τέλος (ώστε ο χρήστης να μην χρειάζεται να κυλάει με το ποντίκι στην αρχή για να το βρει). Επίσης, από προεπιλογή, μόνο τα 75 πιο πιθανά καθαρά κείμενα θα εμφανιστούν. Μπορούν να εμφανιστούν όλα, προσθέτοντας ένα κενό στην είσοδο πριν το κρυπτοκείμενο.

Θεωρητικά, _οποιαδήποτε_ από τις παραπάνω προτάσεις __θα μπορούσε__ να είναι το καθαρό κείμενο, μιας και δεν ξέρουμε πολλά πράγματα για την λέξη στην μέση. Ένας γνώστης του κινηματογράφου όμως, θα καταλάβει αμέσως ότι πρόκειται για την ταινία του Τομ Χανκς, [_Sleepless in Seattle_](https://en.wikipedia.org/wiki/Sleepless_in_Seattle).

---

Tο δεύτερο κρυπτοκείμενο είναι το `FOOQ FO BQ QSO BDRPMRQ`. Ξέρουμε ότι είναι κρυπτογραφημένο με το ίδιο κλειδί που χρησιμοποιήθηκε στο πρώτο κρυπτοκείμενο. Μπορούμε να το πούμε αυτό στο πρόγραμμά μας, βάζοντάς το να αποκρυπτογραφήσει το `HUOOPUOHH DT HOBQQUO FOOQ FO BQ QSO BDRPMRQ`, που αποτελείται από τα δύο κρυπτοκείμενα ενωμένα.

Μία εκ των πιθανών προτάσεων -και η μόνη που βγάζει νόημα- είναι η `SLEEPLESS IN SEATTLE MEET ME AT THE AIRPORT`, που σημαίνει ότι το δεύτερο καθαρό κείμενο είναι η πρόταση

`MEET ME AT THE AIRPORT`

---

### Μειονεκτήματα στον αλγόριθμο

Στον αλγόριθμο που χρησιμοποιήσαμε υπάρχουν ορισμένα μειονεκτήματα που τον χρήζουν ακατάλληλο για γενική χρήση. Αλλά επειδή ανακαλύφθηκε μετά την συγγραφή του ότι το ερώτημα της άσκησης ζητούσε απλά την αποκρυπτογράφηση των δοθέντων κειμένων, και όχι την δημιουργία ενός γενικού προγράμματος αποκρυπτογράφισης, τα μειονεκτήματα κρίνονται ανεκτά για τους σκοπούς της άσκησης.

*
  __Ο αλγόριθμος είναι αργός και ακατάλληλος για μεγάλα κείμενα.__ Η αποκρυπτογράφιση της παραπάνω πρότασης εφτά λέξεων πήρε μισό λεπτό σε έναν υπολογιστή με Intel Core i7. Πρακτικά, ο αλγόριθμος είναι μια εξευγενισμένη μορφή της εξαντλητικής αναζήτησης, όπου αντί για το κλειδί, αυτό που αναζητάται εξαντλητικά είναι οι λέξεις της αγγλικής γλώσσας. Αυτό σημαίνει ότι τουλάχιστον η πολυπλοκότητα είναι εκθετική ως προς το μήκος των λέξεων, αντί για την παραγοντική ως προς το μέγεθος του αλφαβήτου.

  [Μια άλλη ενδιαφέρουσα προσέγγιση](https://planetcalc.com/8047/) χρησιμοποιεί μια μορφή εξελικτικού αλγορίθμου με τη συνάρτηση καταλληλότητάς του να βασίζεται στη συχνότητα των _τετράδων γραμμάτων_ -αντί των σκέτων γραμμάτων- σε ένα δείγμα αγγλικού κειμένου. Όμως, δεν κατάφερε να αποκρυπτογραφήσει τα μικρά κρυπτοκείμενά μας.

* Ο αλγόριθμος είναι πολύ αυστηρός στα ορθογραφικά λάθη. Για παράδειγμα, δεν βρήκε κανένα καθαρό κείμενο για την πρόταση `HUOOPUOH DT HOBQQUO`, που της λείπει ένα `H` στο τέλος της πρώτης λέξης. Αλλά κι' αν έβρισκε, το αποτέλεσμα θα ήταν πολύ διαφορετικό, μιας και δεν υπάρχει στο λεξικό η λέξη "SLEEPLES~~S~~".

## Ερώτημα 3

> __Σημείωση:__ Οι έντονες γραμμές αποτελούν τις απαντήσεις στα επιμέρους ερωτήματα.

1. Ο AES-128 έχει 2<sup>128</sup> ~ 3*10<sup>38</sup> διαφορετικά κλειδιά.

2. Ένα κύκλωμα ASIC κοστίζει 50€ (100€ = 10<sup>2</sup> με την επιβάρυνση 100%).

3. Ένα κύκλωμα ASIC μπορεί να δοκιμάσει 5*10<sup>8</sup> κλειδιά ανά δευτερόλεπτο.

4. Ο προϋπολογισμός μας είναι 1.000.000€ = 10<sup>6</sup>€.

5. __Με τον προϋπολογισμό μας, μπορούμε να αγοράσουμε 10.000 = 10<sup>4</sup> κυκλώματα ASIC.__ _(από διαίρεση του 2 με το 4)_

6. Τα κυκλώματά μας μπορούν να δοκιμάσουν 5*10<sup>12</sup> κλειδιά κάθε δευτερόλεπτο. _(από πολλαπλασιασμό του 3 με το 5)_

7. Για να δοκιμαστούν όλα τα κλειδιά, θα χρειαστούν κατά μέσο όρο 6*10<sup>25</sup> δευτερόλεπτα. _(από διαίρεση του 1 με το 6)_

8. Ένας χρόνος περιέχει [σχεδόν](https://en.wikipedia.org/wiki/Leap_year) [πάντα](https://en.wikipedia.org/wiki/Leap_second) 60 * 60 * 24 * 365 = 31.536.000 ~ 3*10<sup>7</sup> δευτερόλεπτα.

9. __Για να δοκιμαστούν όλα τα κλειδιά, θα χρειαστούν κατά μέσο όρο 2*10<sup>18</sup> χρόνια.__ _(από διαίρεση του 7 με το 8)_

10. Η ηλικία του Σύμπαντος είναι περίπου 10<sup>10</sup> χρόνια.

11. __Για να δοκιμαστούν όλα τα κλειδιά, θα χρειαστεί να περάσει χρονικό διάστημα περίπου ίσο με 2*10<sup>8</sup> φορές την ηλικία του σύμπαντος.__ _(από διαίρεση του 9 με το 10)_

12. Μία μέρα έχει κατά μέσο όρο 86.400 ~ 9*10<sup>4</sup> δευτερόλεπτα.

13. Για να δοκιμαστούν όλα τα κλειδιά μέσα σε μια μέρα, θα χρειαστεί η ισχυς της διαδικασίας μας να γίνει 6.6\*10<sup>20</sup> φορές καλύτερος. _(από διαίρεση του 7 με το 12)_

14. Για να αναπτυχθεί η τεχνολογία αρκετά ώστε να μπορούν να δοκιμαστούν όλα τα κλειδιά μέσα σε μια μέρα, θα χρειαστούν περίπου 69 επαναλήψεις του νόμου του Moore. _(από δυαδικό λογάριθμο του 13)_

15. Μια επανάληψη του νόμου του Moore συμβαίνει κάθε ενάμιση χρόνο.

16. __Για να αναπτυχθεί η τεχνολογία αρκετά ώστε να μπορούν να δοκιμαστούν όλα τα κλειδιά μέσα σε μια μέρα, θα χρειαστεί να περάσουν περίπου 103.5 χρόνια.__ _(από πολλαπλασιασμό του 14 με το 15)_

## Παράρτημα Α: Ο κώδικας του προγράμματος

``` python
# Insert program here...
```
