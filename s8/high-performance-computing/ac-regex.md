# Χρήση του αλγορίθμου Aho-Corasick στη βιβλιοθήκη κανονικών εκφράσεων του .NET.

### Τσιρπάνης Θεόδωρος `dai19090`

## Εισαγωγή

### Ο αλγόριθμος Aho-Corasick

Ο [αλγόριθμος Aho-Corasick](https://en.wikipedia.org/wiki/Aho%E2%80%93Corasick_algorithm) είναι ένας αλγόριθμος αναζήτησης κειμένου που εφευρέθηκε από τους Alfred V. Aho και Margaret J. Corasick το 1975. Δέχεται σαν είσοδο ένα σύνολο συμβολοσειρών (τις _λέξεις_), το προεπεξεργάζεται, και δημιουργεί μια μηχανή καταστάσεων βασισμένη σε ένα δέντρο συμβολισειρών (_trie_), με την οποία μπορεί σε αυθαίρετο κείμενο να βρει παρουσίες μίας εκ των λέξεων.

Για την λειτουργία του αλγορίθμου, κάθε κόμβος του δέντρου επαυξάνεται με τρεις τιμές, που αντιστοιχούν σε κάποιον κόμβο του δέντρου:

* Κάθε κόμβος έχει μια δυαδική τιμή που προσδιορίζει αν η συμβολοσειρά που του αντιστοιχεί ανήκει στις λέξεις που θέλουμε να βρούμε.
* Ο _σύνδεσμος επιθήματος_ (suffix link) ενός κόμβου $A$ είναι ο κόμβος $B$ που αντιστοιχεί στο μεγαλύτερο επίθημα της συμβολοσειράς του $A$ που ανήκει στο δέντρο. Το επίθημα αυτό μπορεί να είναι η κενή συμβολοσειρά, η οποία αντιστοιχεί στη ρίζα του δέντρου. Εκτός από την ρίζα, ο σύνδεσμος επιθήματος ενός κόμβου δεν μπορεί να είναι ο ίδιος με τον εαυτό του.
* Ο _σύνδεσμος ευρετηρίου_ (dictionary link) ενός κόμβου $A$ είναι ο κόμβος $B$ που αντιστοιχεί στο μακρύτερο επίθημα της συμβολοσειράς του $A$ που ανήκει στο δέντρο και στις λέξεις που θέλουμε να βρούμε. Αν δεν υπάρχει, το επίθημα αυτό μπορεί να είναι η κενή συμβολοσειρά, η οποία αντιστοιχεί στη ρίζα του δέντρου. Εκτός από την ρίζα, ο σύνδεσμος ευρετηρίου ενός κόμβου δεν μπορεί να είναι ο ίδιος με τον εαυτό του.

Ο αλγόριθμος διαβάζει από την συμβολοσειρά εισόδου έναν χαρακτήρα ανά φορά, και διατηρεί μεταξύ των επαναλήψεων μια μεταβλητή που δηλώνει τον τωρινό κόμβο του δέντρου που βρίσκεται, ο οποίος είναι αρχικά η ρίζα του δέντρου.

Σε κάθε επανάληψη πραγματοποιούνται τα εξής, όπου $i$ η τρέχουσα θέση της συμβολοσειράς εισόδου (με τον πρώτο χαρακτήρα να είναι στη θέση $0$) και $c$ ο τρέχον χαρακτήρας της εισόδου:

1. Από τον τωρινό κόμβο του δέντρου ελέγχουμε αν υπάρχει μετάβαση μέσω του χαρακτήρα $c$ σε κάποιον κόμβο.
    * Αν υπάρχει, θέτουμε τον τωρινό κόμβο σε αυτόν που οδηγεί η μετάβαση, και πηγαίνουμε στο βήμα 2.
    * Αν δεν υπάρχει:
        * Αν ο τωρινός κόμβος είναι η ρίζα του δέντρου, πηγαίνουμε στο βήμα 2.
        * Αν δεν είναι, θέτουμε τον τωρινό κόμβο στον σύνδεσμο επιθήματός του, και επαναλαμβάνουμε το βήμα 1.
2. Από τον τωρινό κόμβο του δέντρου, ανατρέχουμε προς τα πίσω μέσω των συνδέσμων ευρετηρίου, μέχρι να φτάσουμε στη ρίζα του δέντρου. Για κάθε κόμβο $x$ που συναντάμε και που η συμβολοσειρά του ανήκει στις λέξεις που θέλουμε να βρούμε, κάνουμε τα εξής:
    * Έστω $matchPos = i + 1 - length(x)$ η θέση της λέξης που βρήκαμε, όπου `length(x)` το μήκος της συμβολοσειράς που αντιστοιχεί στον κόμβο $x$ (αν δεν το έχουμε κρατήσει κάπου, μπορούμε να το υπολογίσουμε εύκολα βρίσκοντας το ύψος του κόμβου στο δέντρο).
    * Δηλώνουμε με κάποιον τρόπο ότι έχουμε βρει τη λέξη που αντιστοιχεί στον κόμβο $x$, στη θέση $matchPos$.

### Η βιβλιοθήκη κανονικών εκφράσεων του .NET
